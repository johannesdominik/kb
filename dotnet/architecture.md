# .NET Architecture

Latest .NET (Full) Framework Version: 4.8 (04/2019)

Latest .NET Core Version: 3.1 (LTS, 12/2019)

Current .NET Version: 5.0 (11/2020) using CoreCLR

# .NET Platform Overview

![](images/Screenshot_2020-11-07_at_22.38.57.png)

Each .NET framework implementation consists at least of the Common Language Runtime (CLR) and a class library.

# Implementations of .NET

A .NET app is developed for and runs in one or more implementations.

## .NET (Full) Framework

- until 2019 most stable and comprehensive implementation
- Windows only
- you should move away from it ASAP

![](images/Screenshot_2020-11-07_at_22.40.01.png)

## .NET Core

- MIT license
- CoreFX: basis functionality of .NET Framework Library
- CoreCLR: runtime
- for Linux, MacOS X and Windows
- components via NuGet Package Manager
- different deployment types

## Mono

- MIT license
- best when a small runtime is required
- runtime compatible with .NET
- provides a lot of functionalities from the .NET Full Framework
- for Linux, MacOS X and Windows

## Xamarin

- based on Mono
- for native applications on iOS and Android

## .NET 5

- merges Full Framework with .NET Core
- run time: CoreCLR (default), Mono

## Universal Windows Platform

- built on top of .NET Core (not really an own implementation)
- for touch-enabled Windows applications and IoT
- multiple devices (PC, tablet, phone, Xbox)

# .NET Standard

The API specification implemented by the Base Class Library of a .NET implementation.

![](images/Screenshot_2020-11-07_at_22.42.03.png)

Software that is developed under a specific .NET standard does not rely on a specific implementation. Any component binaries that used an implementation that implements the .NET standard can be exchanged with each other.

- The higher the version, the more APIs are available to your library's code.
- The lower the version, the more apps and libraries can use your library.

.NET Framework Compatibility Mode: .NET Standard 2.0

# Common Language Runtime

C# code is compiled into Common Intermediate Language (CIL) code. It is platform independent. The CLR compiles the IL into native machine code (just in time compilation, JIT).

- runs security checks
- memory and error management
- is a virtual machine (processor in software)
- easy code generation (stack machine)
- compilation to native code at compilation time possible with .NET Native on .NET Core

## Components

1. Common Type System
2. Common Intermediate Language (CIL): generated by all .NET compilers and run by CLR
3. Just in Time Compiler (JIT)
4. Virtual Execution System (run time)

![](images/Screenshot_2020-11-07_at_22.43.31.png)

![](images/Screenshot_2020-11-07_at_22.44.28.png)

# .NET CLI

## Basic Console Application

```powershell
dotnet --help
dotnet --version
dotnet --info
dotnet --list-sdks
dotnet new --help
dotnet new --list
dotnet new console --output PrimeCalc --force # create new console app
```

PrimeCalc.csproj

```xml
<Project Sdk="Microsoft.NET.Sdk">
	<PropertyGroup>
		<OutputType>Exe</OutputType>
		<TargetFramework>netcoreapp3.1</TargetFramework>
	</PropertyGroup>
</Project>
```

```powershell
dotnet build
dotnet run
dotnet restore # load NuGet dependencies, also executed at build time
dotnet .\bin\Debug\netcoreapp3.1\PrimeCalc.exe
dotnet run --project PrimeCalc.Client
```

## Working with Libraries

```powershell
dotnet new sln --output PrimeCalc
dotnet new console --output PrimeCalc.Client
dotnet new classlib --output PrimeCalc.Math
dotnet sln add .\PrimeCalc.Client\PrimeCalc.Client.csproj .\PrimeCalc.Math\PrimeCalc.Math.csproj
dotnet add PrimeCalc.Client reference PrimeCalc.Math
dotnet add PrimeCalc.Client package Newtonsoft.json
```

## Terminology

- Framework: implementation of .NET Standard
- Runtime: OS + CPU architecture (runtime identifier such as win10-x64, linux-x64, osx.10.10-x64, ...)

# Assemblies

- a .NET program consists of Assemblies (separated installable units, DLL or EXE)
- easy deployment (private, shared, public)
- Assemblies consist of a Manifest (central entry point), one or more modules (IL or native code + metadata) and resources (strings, icons, images, ...)

![](images/Screenshot_2020-11-07_at_22.46.04.png)

## Metadata

- information about the data types in an Assembly
- fixed part of the CIL
- access via Reflection

## Full Framework: Private Assemblies

- install by copy (no entries in registry)
- used by an application
- installed in same directory of the application
- Configuration: Application.exe.config

## Full Framework: Public (Shared) Assemblies

- assigned a strong name which consists of:
    - name of component
    - public key (company id)
    - culture (language/country e.g. en-US, de-AT)
    - version: <major>.<minor><build><nr>
- installed in Global Assembly Cache (GAC): %windir%/assembly
    - GAC_MSIL: architecture independent
    - GAC_32 / GAC_64: OS architecture
- every application is bound to a specific Assembly version

## File Structure in .NET Core

%ProgramFiles%/dotnet

%ProgramFiles%/store: Runtime Package Store (central location for storing third-party components)

## .NET Core Deployment Strategies

### Framework-dependent Deployment (FDD)

- system-wide installation of .NET Core will be used

![](images/Screenshot_2020-11-07_at_22.47.59.png)

**Advantages**

- runs on different .NET installations and platforms
- efficient usage of hard drive

**Disadvantages**

- version needs to be installed on the system
- behavior of CoreFX components can change

```powershell
dotnet publish PrimeCalc.Client --configuration Release --output $pwd/fdd
```

### Framework-dependent Executables (FDE)

- system-wide installation of .NET Core will be used
- executable will be generated based on runtime

![](images/Screenshot_2020-11-07_at_22.48.37.png)

**Advantages**

- can be executed directly
- runs on different .NET installations and platform
- efficient usage of hard drive

**Disadvantages**

- version needs to be installed on the system
- behavior of CoreFX components can change

### Self-contained Deployment (SCD)

- application comes with all components (components, third-party components, .NET Core libraries, runtime)

Runtime Identifier Catalog: [https://docs.microsoft.com/en-us/dotnet/core/rid-catalog](https://docs.microsoft.com/en-us/dotnet/core/rid-catalog)

![](images/Screenshot_2020-11-07_at_22.49.10.png)

**Advantages**

- full control about used components
- coexistance of multiple runtimes

**Disadvantages**

- waste of hard drive storage
- only runs on runtimes we made the package for

```powershell
dotnet publish PrimeCalc.Client --configuration Release --self-contained --runtime win-x64 --output $pwd/scd-win-x64
dotnet publish PrimeCalc.Client --configuration Release --self-contained --runtime linux-musl-x64 --ouput $pwd/scd-linux-musl-x64
```

### Single-file Executables

- all components in one executable

![](images/Screenshot_2020-11-07_at_22.49.54.png)

**Advantages**

- easy deployment
- full control about used components
- coexistance of multiple runtimes

**Disadvantages**

- waste of hard drive storage
- could be less performant

```powershell
dotnet publish PrimeCalc.Client --configuration Release --runtime win-x64 --output $pwd/sfe-win-x64 -p:PublishSingleFile=true -p:PublishTrimmed=true
```
